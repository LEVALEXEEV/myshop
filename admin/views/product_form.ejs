<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MyShop Admin — <%= mode === 'create' ? 'New Product' : 'Edit Product' %></title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; padding: 24px; }
      a { color: #0b57d0; text-decoration:none; }
      .row { display:flex; gap: 16px; flex-wrap: wrap; }
      .col { flex: 1 1 320px; }
      label { display:block; margin-top: 12px; }
      input, textarea { width: 100%; padding: 10px; margin-top: 6px; box-sizing: border-box; }
      textarea { min-height: 120px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
      .btns { display:flex; gap: 10px; margin-top: 16px; align-items:center; }
      button { padding: 10px 12px; }
      .danger { background: #fff; border: 1px solid #b00020; color: #b00020; }
      .muted { color:#666; font-size: 14px; }
      .preview { display:flex; gap:12px; flex-wrap: wrap; margin-top: 12px; }
      .preview img { max-width: 240px; border: 1px solid #ddd; border-radius: 8px; }
      .box { border: 1px solid #ddd; border-radius: 12px; padding: 12px; margin-top: 16px; }
    </style>
  </head>
  <body>
    <p><a href="/products">← back to list</a> · <% if (mode === 'edit') { %><a href="/products/<%= product.id %>/stock">stock</a><% } %></p>

    <h1><%= mode === 'create' ? 'New product' : `Edit product #${product.id}` %></h1>

    <form method="post" action="<%= mode === 'create' ? '/products' : `/products/${product.id}` %>">
      <input type="hidden" name="_csrf" value="<%= csrfToken %>" />

      <div class="row">
        <div class="col">
          <label>
            Title
            <input name="title" value="<%= product.title ?? '' %>" required />
          </label>

          <label>
            Price (integer)
            <input name="price" type="number" min="0" step="1" value="<%= product.price ?? 0 %>" required />
          </label>

          <label>
            Category
            <input name="category" value="<%= product.category ?? '' %>" />
          </label>

          <label>
            Sold out
            <input name="sold_out" type="checkbox" <%= product.sold_out ? 'checked' : '' %> />
          </label>

          <div class="box">
            <div class="muted">Image fields should be paths like <b>/images/products/your-file.webp</b></div>

            <label>
              Image (required)
              <input name="image" value="<%= product.image ?? '' %>" required />
            </label>

            <label>
              Image hover
              <input name="image_hover" value="<%= product.image_hover ?? '' %>" />
            </label>

            <label>
              Size chart
              <input name="size_chart" value="<%= product.size_chart ?? '' %>" />
            </label>

            <label>
              Extra images (one per line)
              <textarea name="extra_images_text"><%= product.extra_images_text ?? '' %></textarea>
            </label>

            <% if (product.image) { %>
              <div class="preview">
                <div>
                  <div class="muted">image</div>
                  <img src="<%= product.image %>" alt="image" />
                </div>
                <% if (product.image_hover) { %>
                <div>
                  <div class="muted">hover</div>
                  <img src="<%= product.image_hover %>" alt="hover" />
                </div>
                <% } %>
              </div>
            <% } %>
          </div>
        </div>

        <div class="col">
          <label>
            Description (HTML allowed)
            <textarea name="description"><%= product.description ?? '' %></textarea>
          </label>
        </div>
      </div>

      <div class="btns">
        <button type="submit">Save</button>
        <% if (mode === 'edit') { %>
          <a href="/products/<%= product.id %>/stock">Edit stock</a>
        <% } %>
      </div>
    </form>

    <% if (mode === 'edit') { %>
      <div class="box" style="margin-top:16px;">
        <h3>Upload & set field</h3>
        <form method="post" action="/upload" enctype="multipart/form-data">
          <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
          <input type="hidden" name="productId" value="<%= product.id %>" />

          <label>
            Folder
            <select name="folder">
              <option value="products">products</option>
              <option value="size-charts">size-charts</option>
            </select>
          </label>

          <label>
            Set field
            <select name="field">
              <option value="image">image</option>
              <option value="image_hover">image_hover</option>
              <option value="size_chart">size_chart</option>
	      <option value="extra_images">extra_images (append)</option>
            </select>
          </label>

          <label>
            Base name
            <input name="baseName" value="product-<%= product.id %>" />
          </label>

          <label>
            File
            <input name="file" type="file" accept="image/*" required />
          </label>

          <div class="btns">
            <button type="submit">Upload & set</button>
          </div>
        </form>
      </div>
    <% } %>

    <% if (mode === 'edit') { %>
      <form method="post" action="/products/<%= product.id %>/delete" onsubmit="return confirm('Delete product?');" style="margin-top:16px;">
        <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
        <button class="danger" type="submit">Delete</button>
      </form>
    <% } %>
  </body>
</html>
